<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace = "communityMapper">

	<!-- 게시글 총 개수 -->
	<select id="listCount" resultType="_int">
		SELECT COUNT(*)
		FROM COMMUNITY_POST
	</select>
	
	<!-- 검색된 게시글 개수 -->
	<select id="searchListCount" resultType="_int">
		SELECT COUNT(*)
		FROM COMMUNITY_POST
		<choose>
			<when test="condition == 'title'">
				WHERE TITLE LIKE '%' || #{keyword} || '%'
			</when>
			<when test="condition == 'writer'">
				WHERE MEMBER_ID = #{keyword}
			</when>
			<otherwise>
				WHERE CONTENT LIKE '%' || #{keyword} || '%'
			</otherwise>
		</choose>
	</select>
	
	<!-- 필터링된 게시글 개수 -->
	<select id="filterListCount" resultType="_int">
		SELECT COUNT(*)
		FROM COMMUNITY_POST
		WHERE CATEGORY = #{category}
	</select>
	
	<!-- 게시글 목록 조회 -->
	<select id="communityList" resultType="CommunityPostVO">
		SELECT POST_ID
 			  ,MEMBER_ID
 			  ,TITLE
			  ,VIEW_COUNT
			  ,LIKE_COUNT
			  ,COMMENT_COUNT
			  ,CREATED_AT
 			  ,CATEGORY
		FROM COMMUNITY_POST
		ORDER BY UPDATED_AT DESC
	</select>
	
	<!-- 게시글 검색 조회 -->
	<select id="searchList" resultType="CommunityPostVO" parameterType="hashmap">
		SELECT POST_ID
 			  ,MEMBER_ID
 			  ,TITLE
			  ,VIEW_COUNT
			  ,LIKE_COUNT
			  ,COMMENT_COUNT
			  ,CREATED_AT
 			  ,CATEGORY
		FROM COMMUNITY_POST
		<choose>
			<when test="condition == 'title'">
				WHERE TITLE LIKE '%' || #{keyword} || '%'
			</when>
			<when test="condition == 'writer'">
				WHERE MEMBER_ID = #{keyword}
			</when>
			<otherwise>
				WHERE CONTENT LIKE '%' || #{keyword} || '%'
			</otherwise>
		</choose>
		ORDER BY UPDATED_AT DESC
	</select>
	
	<!-- 게시글 필터링 조회 -->
	<select id="filterList" resultType="CommunityPostVO" parameterType="hashmap">
		SELECT POST_ID
 			  ,MEMBER_ID
 			  ,TITLE
			  ,VIEW_COUNT
			  ,LIKE_COUNT
			  ,COMMENT_COUNT
			  ,CREATED_AT
 			  ,CATEGORY
		FROM COMMUNITY_POST
		WHERE CATEGORY = #{category}
		ORDER BY UPDATED_AT DESC
	</select>
 	
 	<!-- 게시글 등록 -->
 	<insert id="communityInsert" parameterType="CommunityPostVO">
 		INSERT INTO
 		COMMUNITY_POST(
 			POST_ID
 			,MEMBER_ID
 			,TITLE
 			,CONTENT
 			,HAS_FILES
 			,CHANGE_NAME
 			,ORIGIN_NAME
 			,CATEGORY
 		)VALUES(
 			#{postId}
 			,#{memberId}
 			,#{title}
 			,#{content}
 			,#{hasFiles}
 			,#{changeName}
 			,#{originName}
 			,#{category}
 		)	
 	</insert>
 	
 	<!-- 게시글 수정 -->
 	<update id="communityUpdate" parameterType="CommunityPostVO">
 		UPDATE COMMUNITY_POST
 		SET
 		TITLE = #{title}
 		,CONTENT = #{content}
 		,HAS_FILES = #{hasFiles}
 		,CHANGE_NAME = #{changeName}
 		,ORIGIN_NAME = #{originName}
 		,UPDATED_AT =  #{updatedAt}
 		,CATEGORY = #{category}
 		WHERE POST_ID = #{postId}
 	</update>
 
 	<!-- 게시글 상세보기 -->
 	<select id="communityDetail" resultType="CommunityPostVO" parameterType="_int">
 		SELECT POST_ID
 				,MEMBER_ID
 				,TITLE
 				,CONTENT
 				,ORIGIN_NAME
 				,CHANGE_NAME
 				,CATEGORY
 		FROM COMMUNITY_POST
 		WHERE POST_ID = #{postId}
 	</select>
 	
 	<!-- 게시글 삭제 -->
 	<delete id="communityDelete" parameterType="_int">
 		DELETE FROM COMMUNITY_POST
 		WHERE
 		POST_ID = #{postId}
 	</delete>
 	
 	
</mapper>
