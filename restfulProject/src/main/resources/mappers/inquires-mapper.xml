<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace = "inquiriesMapper">
	
	<!-- 건의글 총 개수 -->
	<select id="listCount" resultType="_int">
		SELECT COUNT(*) 
		FROM INQUIRIES
	</select>

	<!-- 검색된 건의글 개수 -->
	<select id="searchListCount" resultType="_int">
		SELECT COUNT(*)
		FROM INQUIRIES
		<choose>
			<when test="condition == 'title'">
				WHERE TITLE LIKE '%' || #{keyword} || '%'
			</when>
			<when test="condition == 'writer'">
				WHERE MEMBER_ID = #{keyword}
			</when>
			<when test="condition == 'content'">
				WHERE CONTENT LIKE '%' || #{keyword} || '%'
			</when>
		</choose>
	</select>

	<!-- 필터링된 건의글 개수 -->
	<select id="filterListCount" resultType="_int">
		SELECT COUNT(*)
		FROM INQUIRIES
		WHERE STATUS = #{status}
	</select>

	<!-- 건의글 목록 조회 -->
	<select id="inquiriesList" resultType="InquiriesVO">
		SELECT INQUIRIES_ID
			  ,MEMBER_ID
			  ,TITLE
			  ,CONTENT
			  ,STATUS
			  ,IS_PUBLIC
			  ,UPDATED_AT
			  ,RESOLVED_AT
			  ,VIEW_COUNT
			  ,IS_FAQ
		FROM INQUIRIES
		ORDER BY IS_FAQ DESC
				,UPDATED_AT DESC
	</select>

	<!-- 건의글 검색 조회 -->
	<select id="searchList" resultType="InquiriesVO" parameterType="hashmap">
		SELECT INQUIRIES_ID
			  ,MEMBER_ID
			  ,TITLE
			  ,CONTENT
			  ,STATUS
			  ,IS_PUBLIC
			  ,UPDATED_AT
			  ,RESOLVED_AT
			  ,VIEW_COUNT
			  ,IS_FAQ
		FROM INQUIRIES
		<choose>
			<when test="condition == 'title'">
				WHERE TITLE LIKE '%' || #{keyword} || '%'
			</when>
			<when test="condition == 'writer'">
				WHERE MEMBER_ID = #{keyword}
			</when>
			<when test="condition == 'content'">
				WHERE CONTENT LIKE '%' || #{keyword} || '%'
			</when>
		</choose>
		ORDER BY IS_FAQ DESC
				,UPDATED_AT DESC
	</select>

	<!-- 건의글 필터링 조회 -->
	<select id="filterList" resultType="InquiriesVO" parameterType="hashmap">
		SELECT INQUIRIES_ID
			  ,MEMBER_ID
			  ,TITLE
			  ,CONTENT
			  ,STATUS
			  ,IS_PUBLIC
			  ,UPDATED_AT
			  ,RESOLVED_AT
			  ,VIEW_COUNT
			  ,IS_FAQ
		FROM INQUIRIES
		WHERE STATUS = #{status}
		ORDER BY IS_FAQ DESC
				,UPDATED_AT DESC
	</select>
	
	<!-- 건의글 조회수 증가 -->
	<update id="increaseCount" parameterType="_int">
		UPDATE INQUIRIES
		SET VIEW_COUNT = VIEW_COUNT + 1
		WHERE INQUIRIES_ID = #{inquiriesId}
	</update>
	
	<!-- 건의글 상세보기 -->
	<select id="selectInquiry" parameterType="_int" resultType="InquiriesVO">
		SELECT INQUIRIES_ID
			  ,MEMBER_ID
			  ,TITLE
			  ,CONTENT
			  ,STATUS
			  ,IS_PUBLIC
			  ,UPDATED_AT
			  ,RESOLVED_AT
			  ,VIEW_COUNT
			  ,IS_FAQ
		FROM INQUIRIES
		WHERE INQUIRIES_ID = #{inquiriesId}
	</select>

	<!-- 건의글 등록 -->
	<insert id="inquiriesInsert" parameterType="map">
		INSERT INTO INQUIRIES (
			INQUIRIES_ID
			,MEMBER_ID
			,TITLE
			,CONTENT
			,IS_PUBLIC
			,IS_FAQ
		)VALUES (
			INQUIRIES_ID_SEQ.NEXTVAL
			,#{memberId}
			,#{title}
			,#{content}
			,#{isPublic}
			,#{isFaq}
		)
	</insert>
	
	<!-- 건의글 수정 -->
	<update id="inquiriesUpdate" parameterType="map">
		UPDATE INQUIRIES
		SET TITLE = #{title},
			CONTENT = #{content},
			IS_PUBLIC = #{isPublic},
			IS_FAQ = #{isFaq},
			UPDATED_AT = SYSDATE
		WHERE INQUIRIES_ID = #{inquiriesId}
		AND MEMBER_ID = #{memberId}
	</update>
	
	<!-- 건의글 삭제 -->
	<delete id="inquiriesDelete" parameterType="map">
		DELETE FROM INQUIRIES
		WHERE INQUIRIES_ID = #{inquiriesId}
		AND MEMBER_ID = #{memberId}
	</delete>
	
	
	
	
	
	
	
 	
</mapper>
